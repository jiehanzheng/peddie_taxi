<%# h1, span12 %>
<%# 
  # TODO: better client_side_validations integration using this https://github.com/bcardarella/client_side_validations#customize-error-rendering
%>
<% content_for :scripts do %>
  <%= javascript_include_tag "map" %>
<% end %>
<div class="span6">
  <div class="page-header">
    <h1><%= h1 %></h1>
    <% if params[:action] == "new" %>
      <p class="text-info">Use the Autocomplete field below to have Peddie Taxi automatically fill out the form for you using information from Google Maps.  Review the information below and you are good to post your first proposal!</p>
      <p class="text-warning"><span class="label label-important">Important</span> Please make sure the venue you are trying to add doesn&rsquo;t exist in our system yet.  We delete duplicates, in addition to any requests 
      associated to duplicates.</p>
    <% end %>
  </div>
  <div class="page-header">
    <h2>Autocomplete</h2>
    <p class="text-info">Type an address below and we will try to fill in as much as we can for you!</p>
    <input id="google_autocomplete" 
           type="text" 
           class="text_field input-block-level"
           data-autocomplete-type="establishment"
           data-autocomplete-output-name="#venue_name"
           data-autocomplete-output-formatted-address="#venue_address"
           data-autocomplete-output-vicinity="#venue_vicinity"
           data-autocomplete-output-website="#venue_description"
           data-autocomplete-output-reference="#venue_reference" />
  </div>

  <%= form_for @venue, :html => { :class => 'form-horizontal' } do |f| %>
    <% if @venue.errors.any? %>
      <div id="error_explanation" class="alert alert-block alert-error">
          <strong><%= pluralize(@venue.errors.count, "error") %> prohibited this venue from being saved:</strong>
          <ul>
          <% @venue.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
          </ul>
        </div>
    <% end %>

    <div class="control-group">
      <%= f.label :name, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :name, { :class => 'text_field input-block-level',
                                  :placeholder => "e.g. Target" } %>
      </div>
    </div>
    
    <div class="control-group">
      <%= f.label :address, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :address, { :class => 'text_field input-block-level',
                                     :placeholder => "e.g. 70 Princeton Hightstown Road, East Windsor, NJ, United States" } %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :vicinity, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :vicinity, { :class => 'text_field input-block-level',
                                      :placeholder => "e.g. 70 Princeton Hightstown Road, East Windsor" } %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :latitude, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :latitude, { :class => 'text_field input-block-level',
                                      :placeholder => "please drag the pin..." } %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :longitude, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :longitude, { :class => 'text_field input-block-level',
                                       :placeholder => "...for automatic filling" } %>
      </div>        
    </div>

    <div class="control-group">
      <%= f.label :description, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_area :description, { :class => 'text_area input-block-level',
                                        :rows => 5,
                                        :placeholder => "Optional" } %>
        <span class="help-block">Describe 
          this venue: why it is good, what the price range is, what their 
          opening hours are, etc.
        </span>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :reference, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :reference, { :class => 'text_field input-block-level',
                                       :placeholder => "Optional" } %>
      </div>
    </div>

    <div class="form-actions">
      <%= f.submit nil, :class => 'btn btn-primary' %>
      <%= link_to "Cancel",
                  venues_path, :class => 'btn' %>
    </div>
  <% end %>
</div>
<div class="span6">
  <div class="map-data-source"
       data-base-latitude="<%= Settings.geo.locations.base.latitude %>"
       data-base-longitude="<%= Settings.geo.locations.base.longitude %>"></div>
  <div class="map well" 
       data-base-latitude="<%= Settings.geo.locations.base.latitude %>"
       data-base-longitude="<%= Settings.geo.locations.base.longitude %>"
       data-enable-draggable-marker="true"
       data-draggable-marker-handle
       data-draggable-marker-sync-lat="input#venue_latitude"
       data-draggable-marker-sync-lon="input#venue_longitude"
       data-draggable-marker-title="New venue"></div>
</div>
